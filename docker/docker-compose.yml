# MyIA MCP Infrastructure
# Single container serving all MCPs via SSE on port 9090
#
# mcp-proxy runs tbxark/mcp-proxy extended with sk-agent Python deps.
# SearXNG and sk-agent both run as stdio subprocesses inside the container.
#
# Usage:
#   docker compose build --no-cache   # Rebuild after code changes
#   docker compose up -d              # Start
#   docker compose logs -f            # Follow logs

services:
  mcp-proxy:
    build:
      context: ..
      dockerfile: docker/mcp-proxy/Dockerfile
    image: myia-mcp-proxy:latest
    container_name: myia-mcp-proxy
    ports:
      - "9090:9090"
    volumes:
      - ./mcp-proxy/config.json:/config/config.json:ro
      - ../mcps/internal/servers/sk-agent/sk_agent_config.json:/opt/sk-agent/sk_agent_config.json:ro
    extra_hosts:
      - host.docker.internal:host-gateway
    healthcheck:
      test: ["CMD", "true"]
      interval: 60s
    restart: unless-stopped
