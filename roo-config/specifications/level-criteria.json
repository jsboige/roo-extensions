{
  "version": "1.2.0",
  "description": "Critères de sélection entre modes simples et complexes pour SDDD (générique et spécifique GLM)",
  "lastUpdated": "2026-01-25",

  "levels": {
    "simple": {
      "description": "Mode pour tâches directes, sans ambiguïté",
      "criteria": [
        "Tâche clairement définie avec un seul objectif",
        "Pas de dépendances externes complexes",
        "Modification de 1-3 fichiers maximum",
        "Pas de décision architecturale requise",
        "Pattern existant à suivre dans le codebase",
        "Temps estimé < 30 minutes"
      ],
      "examples": [
        "Corriger un typo dans la documentation",
        "Ajouter un champ à un fichier JSON existant",
        "Créer un test unitaire pour une fonction existante",
        "Mettre à jour une dépendance mineure",
        "Ajouter un log ou un commentaire"
      ],
      "escalation_triggers": [
        "Découverte d'une dépendance non documentée",
        "Conflit avec un pattern existant",
        "Besoin de modifier plus de 3 fichiers",
        "Question architecturale non résolue"
      ]
    },

    "complex": {
      "description": "Mode pour tâches nécessitant analyse, coordination ou décisions",
      "criteria": [
        "Tâche avec multiples sous-objectifs",
        "Dépendances entre composants",
        "Modification de 4+ fichiers",
        "Décision architecturale ou design requise",
        "Nouveau pattern à établir",
        "Coordination multi-agent nécessaire",
        "Impact sur plusieurs machines"
      ],
      "examples": [
        "Implémenter une nouvelle fonctionnalité MCP",
        "Refactorer un module existant",
        "Résoudre un bug affectant plusieurs composants",
        "Créer une nouvelle stratégie de synchronisation",
        "Modifier le workflow SDDD"
      ],
      "de_escalation_triggers": [
        "Sous-tâche isolée identifiée",
        "Pattern clair établi après analyse",
        "Scope réduit à un seul fichier"
      ]
    }
  },

  "escalation_protocol": {
    "simple_to_complex": {
      "trigger": "Un des escalation_triggers détecté",
      "action": "Documenter le trigger, passer en mode complex",
      "notification": "INTERCOM ou RooSync selon contexte"
    },
    "complex_to_simple": {
      "trigger": "Sous-tâche clairement définie et isolée",
      "action": "Créer sous-tâche simple, continuer en parallèle",
      "notification": "Optionnel - log local suffit"
    }
  },

  "decision_tree": {
    "question_1": {
      "text": "La tâche modifie-t-elle plus de 3 fichiers?",
      "yes": "complex",
      "no": "question_2"
    },
    "question_2": {
      "text": "Y a-t-il une décision architecturale à prendre?",
      "yes": "complex",
      "no": "question_3"
    },
    "question_3": {
      "text": "La tâche nécessite-t-elle coordination avec d'autres agents?",
      "yes": "complex",
      "no": "question_4"
    },
    "question_4": {
      "text": "Existe-t-il un pattern clair à suivre?",
      "yes": "simple",
      "no": "complex"
    }
  },

  "glm_models": {
    "description": "Critères spécifiques pour routage entre GLM 4.7 Flash (simple) et GLM 4.7 (complex)",
    "provider": "z.ai",
    "note": "Section ajoutée pour #351 - Spécifications modèles GLM pour Roo Code",

    "glm-4.7-flash": {
      "model_id": "z-ai/glm-4.7-flash",
      "tier": "simple",
      "temperature": 0.6,
      "max_context_tokens": 131072,
      "description": "Modèle rapide optimisé pour tâches simples et documentation",
      "note": "Contexte réel 131K tokens (les 200K annoncés incluent les tokens de sortie)",

      "use_cases": [
        "Documentation (README, commentaires inline, guides)",
        "Tâches < 50 lignes de code",
        "Communication (messages RooSync, INTERCOM, rapports)",
        "Modifications cosmétiques (formatage, renommage variables)",
        "Corrections typos et erreurs syntaxiques simples",
        "Tests unitaires basiques (assertions simples)",
        "Requêtes SQL simples (SELECT, INSERT, UPDATE basiques)"
      ],

      "escalation_to_glm47": [
        "Erreur après 2 tentatives consécutives",
        "Modification dépasse 100 lignes de code",
        "Tests échouent avec stack trace complexe",
        "Nécessite compréhension de > 3 fichiers",
        "Dépendances circulaires ou conflits détectés",
        "Performance critique requise (< 1s de latence)",
        "Logique métier complexe (state machine, algorithmes)"
      ]
    },

    "glm-4.7": {
      "model_id": "z-ai/glm-4.7",
      "tier": "complex",
      "temperature": 0.7,
      "max_context_tokens": 131072,
      "description": "Modèle complet pour architecture, debugging et features",
      "estimated_cost_per_1k_tokens": 0.001,
      "note": "Contexte réel 131K tokens (les 200K annoncés incluent les tokens de sortie)",

      "use_cases": [
        "Features complètes (nouvelles fonctionnalités end-to-end)",
        "Debugging multi-fichiers (analyse trace complète, root cause)",
        "Refactoring architectural (restructuration modules)",
        "Optimisation performance (algorithmes O(n²) → O(n log n))",
        "Résolution bugs complexes (race conditions, memory leaks, deadlocks)",
        "Migrations de données (schema changes, transformations)",
        "Tests d'intégration E2E complexes (multi-composants)",
        "Analyse sécurité (vulnérabilités OWASP, audit code)",
        "Design patterns (Factory, Observer, Strategy, etc.)",
        "Gestion d'erreurs avancée (retry logic, fallback, circuit breaker)"
      ],

      "de_escalation_to_glm47flash": [
        "Tâche résolue en < 20 lignes finalement",
        "Aucune logique complexe détectée après analyse",
        "Modification purement cosmétique identifiée"
      ]
    },

    "routing_examples": {
      "glm-4.7-flash_tasks": [
        "Ajouter JSDoc à une fonction",
        "Renommer variable pour clarté (camelCase)",
        "Corriger faute de frappe dans message erreur",
        "Formater fichier selon ESLint rules",
        "Créer README.md basique pour module",
        "Test unitaire simple: assertEquals(add(2, 3), 5)"
      ],

      "glm-4.7_tasks": [
        "Implémenter système d'authentification JWT complet",
        "Débugger race condition dans worker pool concurrent",
        "Refactorer monolithe vers architecture microservices",
        "Optimiser requête SQL 5+ JOINs pour performance",
        "Corriger vulnérabilité XSS dans formulaire utilisateur",
        "Migrer DB PostgreSQL v12 → v15 avec transformations"
      ]
    },

    "metrics": {
      "tracked_kpis": {
        "glm-4.7-flash_success_rate": "> 85%",
        "escalation_rate": "< 15%",
        "avg_resolution_time_air": "< 5 min",
        "avg_resolution_time_full": "< 30 min",
        "cost_reduction_vs_full": "> 60%"
      }
    }
  }
}
