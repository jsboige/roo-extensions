# Diagrammes Détaillés pour l'Architecture E-commerce

Ce document contient des diagrammes détaillés qui complètent l'architecture principale décrite dans `architecture-ecommerce-microservices.md`.

## Table des Matières
1. [Architecture Détaillée des Microservices](#architecture-détaillée-des-microservices)
2. [Flux de Traitement des Commandes](#flux-de-traitement-des-commandes)
3. [Architecture de Sécurité](#architecture-de-sécurité)
4. [Topologie de Déploiement Multi-région](#topologie-de-déploiement-multi-région)
5. [Modèle de Données Distribué](#modèle-de-données-distribué)

## Architecture Détaillée des Microservices

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                     FRONTEND LAYER                                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
│  │ Web SPA     │  │ Mobile App  │  │ Admin Portal│  │ Partner API │  │ IoT Devices │            │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘            │
└─────────┼───────────────┼───────────────┼───────────────┼───────────────┼─────────────────────┘
          │               │               │               │               │                      
┌─────────▼───────────────▼───────────────▼───────────────▼───────────────▼─────────────────────┐
│                                     EDGE LAYER                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                  CDN (CloudFront/Akamai)                                 │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                  WAF & DDoS Protection                                   │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                                │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                  API Gateway / Load Balancer                             │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │  │
│  │  │ Rate Limit  │  │ Auth Proxy  │  │ API Docs    │  │ Analytics   │  │ Caching     │    │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────┘  │
└────────────────────────────────────────┬────────────────────────────────────────────────────┘
                                         │
┌────────────────────────────────────────▼────────────────────────────────────────────────────┐
│                                  SERVICE LAYER                                               │
│                                                                                              │
│  ┌──────────────────────┐  ┌──────────────────────┐  ┌──────────────────────┐               │
│  │  DOMAIN: UTILISATEURS│  │  DOMAIN: CATALOGUE   │  │  DOMAIN: COMMANDES   │               │
│  │  ┌─────────────────┐ │  │  ┌─────────────────┐ │  │  ┌─────────────────┐ │               │
│  │  │ Auth Service    │ │  │  │ Product Service │ │  │  │ Cart Service    │ │               │
│  │  │ ┌─────────────┐ │ │  │  │ ┌─────────────┐ │ │  │  │ ┌─────────────┐ │ │               │
│  │  │ │ Login       │ │ │  │  │ │ CRUD        │ │ │  │  │ │ Add/Remove  │ │ │               │
│  │  │ │ Register    │ │ │  │  │ │ Import      │ │ │  │  │ │ Calculate   │ │ │               │
│  │  │ │ OAuth       │ │ │  │  │ │ Pricing     │ │ │  │  │ │ Merge       │ │ │               │
│  │  │ └─────────────┘ │ │  │  │ └─────────────┘ │ │  │  │ └─────────────┘ │ │               │
│  │  └─────────────────┘ │  │  └─────────────────┘ │  │  └─────────────────┘ │               │
│  │                      │  │                      │  │                      │               │
│  │  ┌─────────────────┐ │  │  ┌─────────────────┐ │  │  ┌─────────────────┐ │               │
│  │  │ Profile Service │ │  │  │ Category Service│ │  │  │ Order Service   │ │               │
│  │  │ ┌─────────────┐ │ │  │  │ ┌─────────────┐ │ │  │  │ ┌─────────────┐ │ │               │
│  │  │ │ Get/Update  │ │ │  │  │ │ Hierarchy   │ │ │  │  │ │ Create      │ │ │               │
│  │  │ │ Preferences │ │ │  │  │ │ Attributes  │ │ │  │  │ │ Process     │ │ │               │
│  │  │ │ History     │ │ │  │  │ │ Navigation  │ │ │  │  │ │ Track       │ │ │               │
│  │  │ └─────────────┘ │ │  │  │ └─────────────┘ │ │  │  │ └─────────────┘ │ │               │
│  │  └─────────────────┘ │  │  └─────────────────┘ │  │  └─────────────────┘ │               │
│  │                      │  │                      │  │                      │               │
│  │  ┌─────────────────┐ │  │  ┌─────────────────┐ │  │  ┌─────────────────┐ │               │
│  │  │ Preference Svc  │ │  │  │ Search Service  │ │  │  │ Payment Service │ │               │
│  │  │ ┌─────────────┐ │ │  │  │ ┌─────────────┐ │ │  │  │ ┌─────────────┐ │ │               │
│  │  │ │ Settings    │ │ │  │  │ │ Query       │ │ │  │  │ │ Process     │ │ │               │
│  │  │ │ Consent     │ │ │  │  │ │ Filter      │ │ │  │  │ │ Refund      │ │ │               │
│  │  │ │ Notifications│ │ │  │  │ │ Recommend   │ │ │  │  │ │ Verify      │ │ │               │
│  │  │ └─────────────┘ │ │  │  │ └─────────────┘ │ │  │  │ └─────────────┘ │ │               │
│  │  └─────────────────┘ │  │  └─────────────────┘ │  │  └─────────────────┘ │               │
│  └──────────────────────┘  └──────────────────────┘  └──────────────────────┘               │
│                                                                                              │
│  ┌──────────────────────┐  ┌──────────────────────┐  ┌──────────────────────┐               │
│  │  DOMAIN: LOGISTIQUE  │  │  DOMAIN: MARKETING   │  │  DOMAIN: TRANSVERSAL │               │
│  │  ┌─────────────────┐ │  │  ┌─────────────────┐ │  │  ┌─────────────────┐ │               │
│  │  │ Inventory Svc   │ │  │  │ Promotion Svc   │ │  │  │ Notification Svc│ │               │
│  │  │ ┌─────────────┐ │ │  │  │ ┌─────────────┐ │ │  │  │ ┌─────────────┐ │ │               │
│  │  │ │ Stock       │ │ │  │  │ │ Coupons     │ │ │  │  │ │ Email       │ │ │               │
│  │  │ │ Allocate    │ │ │  │  │ │ Discounts   │ │ │  │  │ │ SMS         │ │ │               │
│  │  │ │ Reserve     │ │ │  │  │ │ Bundles     │ │ │  │  │ │ Push        │ │ │               │
│  │  │ └─────────────┘ │ │  │  │ └─────────────┘ │ │  │  │ └─────────────┘ │ │               │
│  │  └─────────────────┘ │  │  └─────────────────┘ │  │  └─────────────────┘ │               │
│  │                      │  │                      │  │                      │               │
│  │  ┌─────────────────┐ │  │  ┌─────────────────┐ │  │  ┌─────────────────┐ │               │
│  │  │ Shipping Svc    │ │  │  │ Campaign Svc    │ │  │  │ Analytics Svc   │ │               │
│  │  │ ┌─────────────┐ │ │  │  │ ┌─────────────┐ │ │  │  │ ┌─────────────┐ │ │               │
│  │  │ │ Calculate   │ │ │  │  │ │ Schedule    │ │ │  │  │ │ Track       │ │ │               │
│  │  │ │ Track       │ │ │  │  │ │ Target      │ │ │  │  │ │ Report      │ │ │               │
│  │  │ │ Return      │ │ │  │  │ │ Analyze     │ │ │  │  │ │ Predict     │ │ │               │
│  │  │ └─────────────┘ │ │  │  │ └─────────────┘ │ │  │  │ └─────────────┘ │ │               │
│  │  └─────────────────┘ │  │  └─────────────────┘ │  │  └─────────────────┘ │               │
│  │                      │  │                      │  │                      │               │
│  │  ┌─────────────────┐ │  │  ┌─────────────────┐ │  │  ┌─────────────────┐ │               │
│  │  │ Delivery Svc    │ │  │  │ Loyalty Svc     │ │  │  │ Media Svc       │ │               │
│  │  │ ┌─────────────┐ │ │  │  │ ┌─────────────┐ │ │  │  │ ┌─────────────┐ │ │               │
│  │  │ │ Schedule    │ │ │  │  │ │ Points      │ │ │  │  │ │ Upload      │ │ │               │
│  │  │ │ Optimize    │ │ │  │  │ │ Rewards     │ │ │  │  │ │ Transform   │ │ │               │
│  │  │ │ Notify      │ │ │  │  │ │ Tiers       │ │ │  │  │ │ Serve       │ │ │               │
│  │  │ └─────────────┘ │ │  │  │ └─────────────┘ │ │  │  │ └─────────────┘ │ │               │
│  │  └─────────────────┘ │  │  └─────────────────┘ │  │  └─────────────────┘ │               │
│  └──────────────────────┘  └──────────────────────┘  └──────────────────────┘               │
└──────────────────────────────────────┬───────────────────────────────────────────────────────┘
                                       │
┌──────────────────────────────────────▼───────────────────────────────────────────────────────┐
│                                  SERVICE MESH                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐          │
│  │ Service Discovery│  │ Load Balancing  │  │ Circuit Breaking│  │ Observability   │          │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘          │
│                                                                                               │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐          │
│  │ Retry/Timeout   │  │ mTLS Security   │  │ Rate Limiting   │  │ Fault Injection │          │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  └─────────────────┘          │
└──────────────────────────────────────┬────────────────────────────────────────────────────────┘
                                       │
┌──────────────────────────────────────▼────────────────────────────────────────────────────────┐
│                                  DATA LAYER                                                    │
│  ┌─────────────────────────┐  ┌─────────────────────────┐  ┌─────────────────────────┐        │
│  │ OPERATIONAL DATABASES   │  │ ANALYTICAL DATABASES    │  │ CACHING & MESSAGING     │        │
│  │ ┌─────────────────────┐ │  │ ┌─────────────────────┐ │  │ ┌─────────────────────┐ │        │
│  │ │ PostgreSQL Clusters │ │  │ │ Data Warehouse      │ │  │ │ Redis Clusters      │ │        │
│  │ │ (Transactions)      │ │  │ │ (Reporting)         │ │  │ │ (Caching, Sessions) │ │        │
│  │ └─────────────────────┘ │  │ └─────────────────────┘ │  │ └─────────────────────┘ │        │
│  │                         │  │                         │  │                         │        │
│  │ ┌─────────────────────┐ │  │ ┌─────────────────────┐ │  │ ┌─────────────────────┐ │        │
│  │ │ MongoDB Clusters    │ │  │ │ Elasticsearch       │ │  │ │ Kafka Clusters      │ │        │
│  │ │ (Product Catalog)   │ │  │ │ (Search, Logs)      │ │  │ │ (Event Streaming)   │ │        │
│  │ └─────────────────────┘ │  │ └─────────────────────┘ │  │ └─────────────────────┘ │        │
│  │                         │  │                         │  │                         │        │
│  │ ┌─────────────────────┐ │  │ ┌─────────────────────┐ │  │ ┌─────────────────────┐ │        │
│  │ │ Neo4j               │ │  │ │ Time Series DB      │ │  │ │ Object Storage      │ │        │
│  │ │ (Recommendations)   │ │  │ │ (Metrics)           │ │  │ │ (Media, Backups)    │ │        │
│  │ └─────────────────────┘ │  │ └─────────────────────┘ │  │ └─────────────────────┘ │        │
│  └─────────────────────────┘  └─────────────────────────┘  └─────────────────────────┘        │
└────────────────────────────────────────────────────────────────────────────────────────────────┘
```

## Flux de Traitement des Commandes

Le diagramme ci-dessous illustre le flux de traitement d'une commande, de la création du panier jusqu'à la livraison, en mettant en évidence les interactions entre les différents microservices.

```
┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
│ Client   │     │ Cart     │     │ Order    │     │ Payment  │     │ Inventory│     │ Shipping │
│ (Web/App)│     │ Service  │     │ Service  │     │ Service  │     │ Service  │     │ Service  │
└────┬─────┘     └────┬─────┘     └────┬─────┘     └────┬─────┘     └────┬─────┘     └────┬─────┘
     │                │                │                │                │                │
     │  Add to Cart   │                │                │                │                │
     │───────────────>│                │                │                │                │
     │                │                │                │                │                │
     │  Update Cart   │                │                │                │                │
     │<───────────────│                │                │                │                │
     │                │                │                │                │                │
     │  Checkout      │                │                │                │                │
     │───────────────>│                │                │                │                │
     │                │  Validate Cart │                │                │                │
     │                │───────────────>│                │                │                │
     │                │                │                │                │                │
     │                │  Create Order  │                │                │                │
     │                │<───────────────│                │                │                │
     │                │                │                │                │                │
     │  Order Created │                │                │                │                │
     │<───────────────┼────────────────│                │                │                │
     │                │                │  Process Payment                │                │
     │                │                │───────────────>│                │                │
     │                │                │                │                │                │
     │                │                │  Payment Status│                │                │
     │                │                │<───────────────│                │                │
     │                │                │                │                │                │
     │                │                │  If Payment OK │                │                │
     │                │                │───────────────────────────────>│                │
     │                │                │                │  Reserve Stock │                │
     │                │                │                │                │                │
     │                │                │  Stock Reserved│                │                │
     │                │                │<───────────────────────────────│                │
     │                │                │                │                │                │
     │                │                │  Create Shipment               │                │
     │                │                │───────────────────────────────────────────────>│
     │                │                │                │                │                │
     │                │                │  Shipment Created              │                │
     │                │                │<───────────────────────────────────────────────│
     │                │                │                │                │                │
     │  Order Status  │                │                │                │                │
     │<───────────────┼────────────────│                │                │                │
     │                │                │                │                │                │
```
### Saga Pattern pour les Commandes

Pour garantir la cohérence des transactions distribuées, le système utilise le pattern Saga pour le traitement des commandes:

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│ Create Order    │────>│ Process Payment │────>│ Reserve Stock   │────>│ Create Shipment │
└─────────────────┘     └────────┬────────┘     └────────┬────────┘     └────────┬────────┘
                                 │                       │                       │
                                 │                       │                       │
                        ┌────────▼────────┐     ┌────────▼────────┐     ┌────────▼────────┐
                        │ Payment Failed  │     │ Stock Unavailable│     │ Shipping Failed │
                        └────────┬────────┘     └────────┬────────┘     └────────┬────────┘
                                 │                       │                       │
                                 ▼                       ▼                       ▼
                        ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
                        │ Cancel Order    │<────│ Refund Payment  │<────│ Release Stock   │
                        └─────────────────┘     └─────────────────┘     └─────────────────┘
```

## Architecture de Sécurité

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                SECURITY PERIMETER                                        │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐    │
│  │                              WAF & DDoS Protection                               │    │
│  └─────────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐    │
│  │                              API Gateway Security                                │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │    │
│  │  │ Rate Limiting│  │ IP Filtering│  │ Bot Detection│ │ Input Valid.│             │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘             │    │
│  └─────────────────────────────────────────────────────────────────────────────────┘    │
└──────────────────────────────────────┬───────────────────────────────────────────────────┘
                                       │
┌──────────────────────────────────────▼───────────────────────────────────────────────────┐
│                                AUTHENTICATION & AUTHORIZATION                             │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐    │
│  │                              Identity Provider                                   │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │    │
│  │  │ OAuth 2.1   │  │ OIDC        │  │ MFA         │  │ SSO         │             │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘             │    │
│  └─────────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐    │
│  │                              Access Control                                      │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │    │
│  │  │ RBAC        │  │ ABAC        │  │ Token Valid.│  │ Permissions │             │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘             │    │
│  └─────────────────────────────────────────────────────────────────────────────────┘    │
└──────────────────────────────────────┬───────────────────────────────────────────────────┘
                                       │
┌──────────────────────────────────────▼───────────────────────────────────────────────────┐
│                                DATA PROTECTION                                            │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐    │
│  │                              Encryption                                          │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │    │
│  │  │ TLS 1.3     │  │ Data at Rest│  │ PII Encrypt.│  │ Key Mgmt    │             │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘             │    │
│  └─────────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐    │
│  │                              Compliance                                          │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │    │
│  │  │ GDPR        │  │ PCI DSS     │  │ Audit Logs  │  │ Data Masking│             │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘             │    │
│  └─────────────────────────────────────────────────────────────────────────────────┘    │
└──────────────────────────────────────┬───────────────────────────────────────────────────┘
                                       │
┌──────────────────────────────────────▼───────────────────────────────────────────────────┐
│                                INFRASTRUCTURE SECURITY                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐    │
│  │                              Network Security                                    │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │    │
│  │  │ VPC Isolation│ │ Security Grps│ │ NACLs       │  │ Private Link│             │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘             │    │
│  └─────────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐    │
│  │                              Container Security                                  │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │    │
│  │  │ Image Scan  │  │ Runtime Sec.│  │ Pod Security│  │ Secrets Mgmt│             │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘             │    │
│  └─────────────────────────────────────────────────────────────────────────────────┘    │
└──────────────────────────────────────────────────────────────────────────────────────────┘
```

### Flux d'Authentification OAuth 2.1

```
┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
│ Client   │     │ API      │     │ Auth     │     │ Resource │
│ App      │     │ Gateway  │     │ Server   │     │ Server   │
└────┬─────┘     └────┬─────┘     └────┬─────┘     └────┬─────┘
     │                │                │                │
     │  1. Auth Request               │                │
     │───────────────────────────────>│                │
     │                │                │                │
     │  2. Auth Code  │                │                │
     │<───────────────────────────────│                │
     │                │                │                │
     │  3. Token Request (with code)  │                │
     │───────────────────────────────>│                │
     │                │                │                │
     │  4. Access Token + Refresh Token│                │
     │<───────────────────────────────│                │
     │                │                │                │
     │  5. API Request with Access Token              │
     │────────────────>│                │                │
     │                │  6. Validate Token             │
     │                │───────────────>│                │
     │                │                │                │
     │                │  7. Token Valid│                │
     │                │<───────────────│                │
     │                │                │                │
     │                │  8. Forward Request            │
     │                │───────────────────────────────>│
     │                │                │                │
     │                │  9. Response   │                │
     │                │<───────────────────────────────│
     │  10. Response  │                │                │
     │<───────────────│                │                │
     │                │                │                │
```

## Topologie de Déploiement Multi-région

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                     GLOBAL LAYER                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────┐    │
│  │                              Global DNS (Route53/CloudFlare)                             │    │
│  └─────────────────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────┐    │
│  │                              Global CDN (CloudFront/Akamai)                              │    │
│  └─────────────────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────┐    │
│  │                              DDoS Protection (Shield/Cloudflare)                         │    │
│  └─────────────────────────────────────────────────────────────────────────────────────────┘    │
└──────────────────────────────┬───────────────────────────────┬──────────────────────────────────┘
                               │                               │
┌──────────────────────────────▼───────────────┐ ┌─────────────▼────────────────────────────────┐
│                REGION: EUROPE                 │ │               REGION: AMERICAS               │
│  ┌─────────────────────────────────────────┐ │ │ ┌─────────────────────────────────────────┐  │
│  │            Availability Zone 1          │ │ │ │            Availability Zone 1          │  │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  │ │ │ │  ┌─────────┐  ┌─────────┐  ┌─────────┐  │  │
│  │  │ Frontend│  │ Services│  │ Database│  │ │ │ │  │ Frontend│  │ Services│  │ Database│  │  │
│  │  │ Cluster │  │ Cluster │  │ Cluster │  │ │ │ │  │ Cluster │  │ Cluster │  │ Cluster │  │  │
│  │  └─────────┘  └─────────┘  └─────────┘  │ │ │ │  └─────────┘  └─────────┘  └─────────┘  │  │
│  └─────────────────────────────────────────┘ │ │ └─────────────────────────────────────────┘  │
│                                              │ │                                               │
│  ┌─────────────────────────────────────────┐ │ │ ┌─────────────────────────────────────────┐  │
│  │            Availability Zone 2          │ │ │ │            Availability Zone 2          │  │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  │ │ │ │  ┌─────────┐  ┌─────────┐  ┌─────────┐  │  │
│  │  │ Frontend│  │ Services│  │ Database│  │ │ │ │  │ Frontend│  │ Services│  │ Database│  │  │
│  │  │ Cluster │  │ Cluster │  │ Cluster │  │ │ │ │  │ Cluster │  │ Cluster │  │ Cluster │  │  │
│  │  └─────────┘  └─────────┘  └─────────┘  │ │ │ │  └─────────┘  └─────────┘  └─────────┘  │  │
│  └─────────────────────────────────────────┘ │ │ └─────────────────────────────────────────┘  │
│                                              │ │                                               │
│  ┌─────────────────────────────────────────┐ │ │ ┌─────────────────────────────────────────┐  │
│  │            Availability Zone 3          │ │ │ │            Availability Zone 3          │  │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  │ │ │ │  ┌─────────┐  ┌─────────┐  ┌─────────┐  │  │
│  │  │ Frontend│  │ Services│  │ Database│  │ │ │ │  │ Frontend│  │ Services│  │ Database│  │  │
│  │  │ Cluster │  │ Cluster │  │ Cluster │  │ │ │ │  │ Cluster │  │ Cluster │  │ Cluster │  │  │
│  │  └─────────┘  └─────────┘  └─────────┘  │ │ │ │  └─────────┘  └─────────┘  └─────────┘  │  │
│  └─────────────────────────────────────────┘ │ │ └─────────────────────────────────────────┘  │
└──────────────────────────────────────────────┘ └───────────────────────────────────────────────┘
                               │                               │
┌──────────────────────────────▼───────────────┐ ┌─────────────▼────────────────────────────────┐
│                REGION: ASIA-PACIFIC          │ │               DISASTER RECOVERY              │
│  ┌─────────────────────────────────────────┐ │ │ ┌─────────────────────────────────────────┐  │
│  │            Availability Zone 1          │ │ │ │            Cold Standby Region          │  │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  │ │ │ │  ┌─────────────────────────────────┐    │  │
│  │  │ Frontend│  │ Services│  │ Database│  │ │ │ │  │ Replicated Data Storage         │    │  │
│  │  │ Cluster │  │ Cluster │  │ Cluster │  │ │ │ │  └─────────────────────────────────┘    │  │
│  │  └─────────┘  └─────────┘  └─────────┘  │ │ │ │                                         │  │
│  └─────────────────────────────────────────┘ │ │ │  ┌─────────────────────────────────┐    │  │
│                                              │ │ │  │ Infrastructure Templates         │    │  │
│  ┌─────────────────────────────────────────┐ │ │ │  └─────────────────────────────────┘    │  │
│  │            Availability Zone 2          │ │ │ │                                         │  │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  │ │ │ │  ┌─────────────────────────────────┐    │  │
│  │  │ Frontend│  │ Services│  │ Database│  │ │ │ │  │ Automated Recovery Procedures    │    │  │
│  │  │ Cluster │  │ Cluster │  │ Cluster │  │ │ │ │  └─────────────────────────────────┘    │  │
│  │  └─────────┘  └─────────┘  └─────────┘  │ │ │ └─────────────────────────────────────────┘  │
│  └─────────────────────────────────────────┘ │ └───────────────────────────────────────────────┘
└──────────────────────────────────────────────┘
```

## Modèle de Données Distribué

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                     DATA DISTRIBUTION MODEL                                      │
│                                                                                                  │
│  ┌─────────────────────────┐       ┌─────────────────────────┐       ┌─────────────────────────┐│
│  │ DOMAIN: UTILISATEURS    │       │ DOMAIN: CATALOGUE       │       │ DOMAIN: COMMANDES       ││
│  │                         │       │                         │       │                         ││
│  │ ┌─────────────────────┐ │       │ ┌─────────────────────┐ │       │ ┌─────────────────────┐ ││
│  │ │ PostgreSQL          │ │       │ │ MongoDB             │ │       │ │ PostgreSQL          │ ││
│  │ │ - users             │ │       │ │ - products          │ │       │ │ - orders            │ ││
│  │ │ - profiles          │ │       │ │ - categories        │ │       │ │ - order_items       │ ││
│  │ │ - preferences       │ │       │ │ - attributes        │ │       │ │ - payments          │ ││
│  │ │ - auth_tokens       │ │       │ │ - media             │ │       │ │ - invoices          │ ││
│  │ └─────────────────────┘ │       │ └─────────────────────┘ │       │ └─────────────────────┘ ││
│  │                         │       │                         │       │                         ││
│  │ ┌─────────────────────┐ │       │ ┌─────────────────────┐ │       │ ┌─────────────────────┐ ││
│  │ │ Redis               │ │       │ │ Elasticsearch       │ │       │ │ Redis               │ ││
│  │ │ - sessions          │ │       │ │ - product_search    │ │       │ │ - carts             │ ││
│  │ │ - rate_limits       │ │       │ │ - autocomplete      │ │       │ │ - order_status      │ ││
│  │ └─────────────────────┘ │       │ └─────────────────────┘ │       │ └─────────────────────┘ ││
│  └─────────────────────────┘       └─────────────────────────┘       └─────────────────────────┘│
│                                                                                                  │
│  ┌─────────────────────────┐       ┌─────────────────────────┐       ┌─────────────────────────┐│
│  │ DOMAIN: LOGISTIQUE      │       │ DOMAIN: MARKETING       │       │ DOMAIN: ANALYTICS       ││
│  │                         │       │                         │       │                         ││
│  │ ┌─────────────────────┐ │       │ ┌─────────────────────┐ │       │ ┌─────────────────────┐ ││
│  │ │ PostgreSQL          │ │       │ │ PostgreSQL          │ │       │ │ ClickHouse          │ ││
│  │ │ - inventory         │ │       │ │ - promotions        │ │       │ │ - events            │ ││
│  │ │ - warehouses        │ │       │ │ - campaigns         │ │       │ │ - page_views        │ ││
│  │ │ - shipments         │ │       │ │ - loyalty           │ │       │ │ - conversions       │ ││
│  │ └─────────────────────┘ │       │ └─────────────────────┘ │       │ └─────────────────────┘ ││
│  │                         │       │                         │       │                         ││
│  │ ┌─────────────────────┐ │       │ ┌─────────────────────┐ │       │ ┌─────────────────────┐ ││
│  │ │ Redis               │ │       │ │ Redis               │ │       │ │ Kafka               │ ││
│  │ │ - stock_levels      │ │       │ │ - active_promotions │ │       │ │ - event_streams     │ ││
│  │ │ - delivery_zones    │ │       │ │ - user_segments     │ │       │ │ - change_data_capture││
│  │ └─────────────────────┘ │       │ └─────────────────────┘ │       │ └─────────────────────┘ ││
│  └─────────────────────────┘       └─────────────────────────┘       └─────────────────────────┘│
│                                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### Stratégies de Réplication et Synchronisation

1. **Réplication Multi-région**
   - Réplication asynchrone pour les données non critiques
   - Réplication synchrone pour les données critiques (paiements, commandes)
   - Stratégie de résolution de conflits basée sur des horloges vectorielles

2. **Cohérence Éventuelle**
   - Modèle CQRS pour séparer les opérations de lecture et d'écriture
   - Propagation des événements via Kafka pour la synchronisation
   - Snapshots périodiques pour optimiser les reconstructions

3. **Partitionnement**
   - Sharding par région géographique
   - Sharding par ID client pour les grands comptes
   - Partitionnement temporel pour les données historiques